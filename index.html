<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spec Técnica - Casa Goianita | Live Consultoria</title>
    
    <!-- Favicons -->
    <link rel="icon" type="image/x-icon" href="/assets/favicon-C5fpT_x5.ico">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,700;1,400&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Configuração Tailwind - Live V3 Identity -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        live: {
                            bg: '#06192a',       // Azul Petróleo
                            card: '#0A243D',     // Azul Card Profundo
                            accent: '#00e800',   // Verde Vibrante
                            muted: '#cccccc',    // Cinza Leitura
                            subtle: '#a0a0a0',   // Cinza Detalhe
                            danger: '#ff4444',   // Alerta Erro
                            warning: '#ffbb33'   // Alerta Atenção
                        }
                    },
                    fontFamily: {
                        sans: ['Poppins', 'sans-serif'],
                        serif: ['Merriweather', 'serif'],
                        mono: ['Courier New', 'monospace']
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #06192a;
            color: white;
            background-image: url('https://raw.githubusercontent.com/ecossistemalive/assets/main/textures/cubes.png');
            background-attachment: fixed;
            background-size: 400px;
        }

        /* Classes Utilitárias Customizadas */
        .tech-box {
            background-color: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-left: 3px solid #00e800;
            padding: 1rem;
            margin-top: 0.5rem;
            font-family: 'Poppins', sans-serif;
            font-size: 0.85rem;
        }
        
        .tech-tag {
            background: rgba(0, 232, 0, 0.1);
            color: #00e800;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            border: 1px solid rgba(0, 232, 0, 0.2);
        }

        .blocker-box {
            background: rgba(255, 68, 68, 0.05);
            border: 1px solid rgba(255, 68, 68, 0.3);
            border-left: 3px solid #ff4444;
        }

        .fade-in { animation: fadeIn 0.4s ease-out forwards; opacity: 0; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* Abas */
        .tab-btn { transition: all 0.2s; border-bottom: 2px solid transparent; opacity: 0.7; }
        .tab-btn:hover { opacity: 1; color: #fff; }
        .tab-btn.active { opacity: 1; color: #00e800; border-bottom-color: #00e800; background: rgba(255,255,255,0.03); }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #06192a; }
        ::-webkit-scrollbar-thumb { background: #1f3a52; border-radius: 3px; }
    </style>
</head>
<body class="antialiased min-h-screen flex flex-col">

    <!-- Header -->
    <header class="w-full p-6 border-b border-white/10 bg-live-bg/95 backdrop-blur-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto flex flex-col md:flex-row items-center justify-between gap-4">
            <div class="flex items-center gap-4">
                <img src="https://raw.githubusercontent.com/EcossistemaLive/Dashboard_goianita/refs/heads/main/Logo%20Live-26.png" alt="Live Consultoria" class="h-10 w-auto filter drop-shadow-[0_0_8px_rgba(0,232,0,0.3)]">
                <div class="h-8 w-px bg-white/10 hidden md:block"></div>
                <div>
                    <h1 class="text-lg font-bold text-white leading-tight">Spec Técnica <span class="text-live-accent">Casa Goianita</span></h1>
                    <p class="text-xs text-live-subtle font-mono">Module: Wedding_Registry_V2.0</p>
                </div>
            </div>
            <div class="flex gap-3">
                <span class="px-3 py-1 rounded-full border border-live-accent/30 bg-live-accent/5 text-live-accent text-xs font-mono font-bold">STATUS: DEV BRIEFING</span>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto px-4 py-8 max-w-7xl">

        <!-- Navigation Tabs -->
        <div class="flex flex-wrap border-b border-white/10 mb-8 gap-1">
            <button onclick="switchTab('contexto')" id="btn-contexto" class="tab-btn active px-6 py-3 text-sm font-medium">1. Arquitetura & Contexto</button>
            <button onclick="switchTab('anfitriao')" id="btn-anfitriao" class="tab-btn px-6 py-3 text-sm font-medium">2. Módulo Anfitrião (Noiva)</button>
            <button onclick="switchTab('convidado')" id="btn-convidado" class="tab-btn px-6 py-3 text-sm font-medium">3. Módulo Convidado (Compra)</button>
            <button onclick="switchTab('integracoes')" id="btn-integracoes" class="tab-btn px-6 py-3 text-sm font-medium">4. Backoffice & API</button>
        </div>

        <div id="tab-contents">

            <!-- TAB 1: CONTEXTO -->
            <div id="contexto" class="tab-content fade-in block">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Coluna Principal -->
                    <div class="lg:col-span-2 space-y-6">
                        <div class="bg-live-card border border-white/10 rounded-xl p-6">
                            <h2 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                <span class="text-live-accent">⚡</span> Objetivo Técnico
                            </h2>
                            <p class="text-live-muted font-serif text-sm leading-relaxed">
                                Desenvolver um módulo de Listas de Presentes que resolva a <strong>dessincronização de estoque</strong> entre loja física e virtual. O sistema deve priorizar a conversão de presentes em <strong>crédito virtual (Wallet)</strong> para evitar custos logísticos e deve corrigir falhas críticas de UX (endereçamento e validação de dados) relatadas pela operação.
                            </p>
                        </div>

                        <div class="bg-live-card border border-white/10 rounded-xl p-6">
                            <h3 class="text-lg font-bold text-white mb-4">Fluxo de Dados Macro</h3>
                            <div class="flex flex-col gap-2 font-mono text-xs text-live-subtle">
                                <div class="flex items-center gap-3 p-2 bg-black/20 rounded border border-white/5">
                                    <span class="text-live-accent font-bold">[ERP OLIST]</span>
                                    <span>◄── Sync Estoque & Pedidos ──►</span>
                                    <span class="text-white font-bold">[E-COMMERCE / LISTAS]</span>
                                </div>
                                <div class="flex items-center gap-3 p-2 bg-black/20 rounded border border-white/5 ml-8 border-l-2 border-l-live-accent">
                                    <span>↳ Se Estoque = 0 no ERP</span>
                                    <span class="text-live-danger">➜</span>
                                    <span>Venda Converte em Crédito (Wallet)</span>
                                </div>
                                <div class="flex items-center gap-3 p-2 bg-black/20 rounded border border-white/5 ml-8 border-l-2 border-l-live-accent">
                                    <span>↳ Se Venda no PDV Físico</span>
                                    <span class="text-live-accent">➜</span>
                                    <span>Baixa Qty na Lista Web (Webhook)</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Coluna Lateral -->
                    <div class="bg-live-card border border-white/10 rounded-xl p-6 h-fit">
                        <h3 class="text-sm font-bold text-white mb-4 uppercase tracking-wider">Definições Globais</h3>
                        <ul class="space-y-4 text-sm">
                            <li class="border-b border-white/5 pb-2">
                                <span class="block text-live-accent font-bold mb-1">Stack Preferencial</span>
                                <span class="text-live-muted">VTEX IO (Legado) ou Nova Solução Headless integrada ao Olist.</span>
                            </li>
                            <li class="border-b border-white/5 pb-2">
                                <span class="block text-live-accent font-bold mb-1">SLA de Sync</span>
                                <span class="text-live-muted">Estoque: Real-time (Ideal) ou < 5 min.<br>Status Pedido: Real-time.</span>
                            </li>
                            <li>
                                <span class="block text-live-accent font-bold mb-1">UX/UI Guideline</span>
                                <span class="text-live-muted">Mobile First. Evitar reload de páginas em ações de "Adicionar ao Carrinho".</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- TAB 2: ANFITRIÃO -->
            <div id="anfitriao" class="tab-content fade-in hidden">
                <div class="grid gap-6">
                    
                    <!-- 2.1 Cadastro -->
                    <section class="bg-live-card border border-white/10 rounded-xl p-6">
                        <div class="flex justify-between items-start mb-4">
                            <h2 class="text-lg font-bold text-white">2.1. Pré-Cadastro e Login</h2>
                            <span class="tech-tag">CRÍTICO</span>
                        </div>
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="text-sm font-bold text-live-accent mb-2">Regras de Negócio</h4>
                                <ul class="list-disc pl-4 text-sm text-live-muted space-y-2 font-serif">
                                    <li>Usuário deve ter conta "Pessoa Física" antes de criar lista.</li>
                                    <li><strong>Validação de E-mail:</strong> Bloqueio rígido. Usuário digita e-mail, sistema envia Token (6 dígitos) ou Link. Cadastro só conclui após verificação.</li>
                                    <li><em>Motivo:</em> Karinne relatou noivas com e-mails errados perdendo acesso total às listas.</li>
                                </ul>
                            </div>
                            <div class="tech-box">
                                <strong class="block mb-1 text-live-subtle">// Logic Requirement</strong>
                                <code>
                                IF email_verified == FALSE:<br>
                                &nbsp;&nbsp;BLOCK create_list_action()<br>
                                &nbsp;&nbsp;RETURN error("Verifique seu e-mail")
                                </code>
                            </div>
                        </div>
                    </section>

                    <!-- 2.2 Setup da Lista -->
                    <section class="bg-live-card border border-white/10 rounded-xl p-6">
                        <h2 class="text-lg font-bold text-white mb-4">2.2. Configuração da Lista (Wizard)</h2>
                        <div class="space-y-4">
                            
                            <!-- Passo 1 -->
                            <div class="border-l-2 border-live-accent pl-4 pb-4">
                                <h4 class="text-white font-bold text-sm">Passo A: Dados do Evento</h4>
                                <p class="text-live-muted text-xs mb-2">Campos Obrigatórios (Validação Front & Back):</p>
                                <ul class="grid grid-cols-2 gap-2 text-xs text-live-subtle font-mono">
                                    <li class="bg-black/20 p-2 rounded">Nome_Casal (String)</li>
                                    <li class="bg-black/20 p-2 rounded">Data_Evento (Date > Today)</li>
                                    <li class="bg-black/20 p-2 rounded">Tipo_Evento (Enum: Casamento, Chá, Bodas...)</li>
                                </ul>
                            </div>

                            <!-- Passo 2 -->
                            <div class="border-l-2 border-live-accent pl-4">
                                <h4 class="text-white font-bold text-sm">Passo B: Logística & Wallet (Novo)</h4>
                                <p class="text-live-muted text-xs mb-2">Decisão crítica que define o comportamento do checkout do convidado.</p>
                                <div class="bg-live-accent/5 p-3 rounded border border-live-accent/20">
                                    <label class="flex items-center gap-3 cursor-pointer">
                                        <div class="w-4 h-4 border border-live-accent rounded bg-live-accent"></div>
                                        <span class="text-sm text-white font-bold">Opção: "Quero receber em Crédito"</span>
                                    </label>
                                    <p class="text-xs text-live-muted mt-2 ml-7">
                                        Se TRUE: O sistema ignora estoque físico no checkout e gera saldo na Wallet.<br>
                                        Se FALSE: Solicita Endereço de Entrega (Obrigatório validação via API CEP).
                                    </p>
                                </div>
                            </div>

                        </div>
                    </section>

                    <!-- 2.3 Wallet -->
                    <section class="bg-live-card border border-white/10 rounded-xl p-6">
                        <h2 class="text-lg font-bold text-white mb-4">2.3. Dashboard Financeiro (Wallet)</h2>
                        <p class="text-sm text-live-muted mb-4 font-serif">Substituição dos "Vales de Papel".</p>
                        
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="text-sm font-bold text-live-accent mb-2">Funcionalidades</h4>
                                <ul class="list-disc pl-4 text-sm text-live-muted space-y-1">
                                    <li>Visualização de Saldo Total (R$).</li>
                                    <li>Extrato detalhado (Data, Quem Presenteou, Item Convertido).</li>
                                    <li><strong>Gerar Voucher Loja:</strong> Cria QR Code temporário para uso no PDV físico.</li>
                                    <li><strong>Checkout Site:</strong> Usar saldo como método de pagamento parcial ou total.</li>
                                </ul>
                            </div>
                            <div class="tech-box">
                                <strong class="block mb-1 text-live-subtle">// Expiration Logic</strong>
                                <code>
                                Credit_Valid_Until = Credit_Issue_Date + 365_DAYS<br>
                                Cron_Job: Notify user 30 days before expiration.
                                </code>
                            </div>
                        </div>
                    </section>

                </div>
            </div>

            <!-- TAB 3: CONVIDADO -->
            <div id="convidado" class="tab-content fade-in hidden">
                <div class="grid gap-6">

                    <!-- 3.1 Busca -->
                    <section class="bg-live-card border border-white/10 rounded-xl p-6">
                        <h2 class="text-lg font-bold text-white mb-2">3.1. Algoritmo de Busca</h2>
                        <p class="text-sm text-live-muted mb-4">O convidado não tem o ID. A busca deve ser "Fuzzy".</p>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-xs font-mono text-live-subtle">
                            <div class="bg-black/20 p-3 rounded">Input: "Maria e João"<br>Output: Listas de "Maria Silva & João Souza"</div>
                            <div class="bg-black/20 p-3 rounded">Input: "12/12/2025"<br>Output: Listas nesta data</div>
                            <div class="bg-black/20 p-3 rounded text-live-danger border border-live-danger/30">Privacy: Hide Address/Phone in search results.</div>
                        </div>
                    </section>

                    <!-- 3.2 Lógica de Endereçamento (BLOCKER) -->
                    <section class="bg-live-card border border-white/10 rounded-xl p-6 blocker-box">
                        <div class="flex items-center gap-3 mb-4">
                            <span class="bg-live-danger text-white px-2 py-1 rounded text-xs font-bold">PRIORIDADE ZERO</span>
                            <h2 class="text-lg font-bold text-white">3.2. Override de Endereço (Correção Lógica)</h2>
                        </div>
                        
                        <p class="text-sm text-white mb-4 font-serif">
                            Atualmente, o VTEX envia o produto para a casa do convidado (Billing Address). Isso gera retrabalho manual para Karinne.
                        </p>

                        <div class="tech-box bg-black/40">
                            <strong class="block mb-2 text-live-accent">// Pseudocódigo para o Checkout Controller</strong>
                            <pre class="text-xs text-live-muted overflow-x-auto">
FUNCTION process_checkout(cart):
  FOR item IN cart:
    IF item.type == "GIFT_LIST_ITEM":
        
        # 1. Ignorar input do usuário para Shipping
        target_list = get_list_by_id(item.list_id)
        
        # 2. Forçar endereço da lista (Hard Override)
        shipping_address = target_list.delivery_address
        
        # 3. Mascarar dados para o Convidado (LGPD)
        ui_display_address = "Endereço dos Noivos (Cadastrado)"
        
        # 4. Travar edição
        disable_address_edit_field(true)

    ELSE:
        # Fluxo normal para itens pessoais
        shipping_address = user_input_address

  RETURN create_order(cart, shipping_address)
                            </pre>
                        </div>
                    </section>

                    <!-- 3.3 Estoque Virtual -->
                    <section class="bg-live-card border border-white/10 rounded-xl p-6">
                        <h2 class="text-lg font-bold text-white mb-4">3.3. Tratativa de Indisponibilidade (Fallback)</h2>
                        <div class="flex gap-4 items-start">
                            <div class="w-8 h-8 rounded-full bg-live-warning text-black flex items-center justify-center font-bold text-xs shrink-0">!</div>
                            <div>
                                <h4 class="text-sm font-bold text-white">Cenário: Venda sem Estoque Físico</h4>
                                <p class="text-xs text-live-muted mt-1 mb-2">
                                    Se o sistema vender um item que quebrou ou sumiu da loja:
                                </p>
                                <ul class="text-xs text-live-subtle list-disc pl-4 space-y-1">
                                    <li>Backend intercepta o erro de picking/separação.</li>
                                    <li><strong>Ação Automática:</strong> Cancela a linha de entrega do item.</li>
                                    <li><strong>Ação Automática:</strong> Credita o valor na Wallet da Noiva.</li>
                                    <li><strong>Notificação:</strong> Envia e-mail para a Noiva ("Você ganhou crédito referente ao presente X").</li>
                                    <li><em>Obs:</em> Não enviar e-mail de "Cancelamento" para o convidado (gera frustração). O convidado cumpriu seu papel de presentear.</li>
                                </ul>
                            </div>
                        </div>
                    </section>

                </div>
            </div>

            <!-- TAB 4: INTEGRAÇÕES -->
            <div id="integracoes" class="tab-content fade-in hidden">
                <div class="grid gap-6">
                    
                    <section class="bg-live-card border border-white/10 rounded-xl p-6">
                        <h2 class="text-lg font-bold text-white mb-4">4.1. Matriz de Integração (Olist ERP)</h2>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left text-xs text-live-muted font-mono">
                                <thead class="bg-black/30 text-live-accent uppercase border-b border-white/10">
                                    <tr>
                                        <th class="p-3">Endpoint / Evento</th>
                                        <th class="p-3">Direção</th>
                                        <th class="p-3">Payload Crítico</th>
                                        <th class="p-3">Trigger</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-white/5">
                                    <tr>
                                        <td class="p-3 font-bold text-white">GET /stock/{sku}</td>
                                        <td class="p-3">Site ◄ ERP</td>
                                        <td class="p-3">{ qty_available: int }</td>
                                        <td class="p-3">Load Página Produto</td>
                                    </tr>
                                    <tr>
                                        <td class="p-3 font-bold text-white">POST /order</td>
                                        <td class="p-3">Site ► ERP</td>
                                        <td class="p-3">{ list_id, is_wallet_credit: bool }</td>
                                        <td class="p-3">Checkout Success</td>
                                    </tr>
                                    <tr>
                                        <td class="p-3 font-bold text-white">WEBHOOK /sales/physical</td>
                                        <td class="p-3">Site ◄ ERP</td>
                                        <td class="p-3">{ sku, qty_sold, list_reference_id }</td>
                                        <td class="p-3">Venda no Caixa (Loja)</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <p class="text-xs text-live-warning mt-4 bg-live-warning/10 p-2 rounded border border-live-warning/20">
                            <strong>Atenção ao Webhook:</strong> A venda na loja física precisa decrementar a quantidade solicitada na lista web para evitar que o item continue disponível para outros convidados (Problema das "10 Boleiras").
                        </p>
                    </section>

                    <section class="bg-live-card border border-white/10 rounded-xl p-6">
                        <h2 class="text-lg font-bold text-white mb-4">4.2. Painel Admin (Requisitos Karinne)</h2>
                        <ul class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-live-muted">
                            <li class="bg-black/20 p-3 rounded border border-white/5">
                                <strong class="text-white block mb-1">Alertas de Mudança</strong>
                                Notificar Admin via E-mail/Dashboard se Noiva alterar "Data" ou "Endereço" após criação da lista.
                            </li>
                            <li class="bg-black/20 p-3 rounded border border-white/5">
                                <strong class="text-white block mb-1">Gestão de SKUs</strong>
                                Interface para associar SKUs do Olist aos "Produtos Sugeridos" das Listas Prontas.
                            </li>
                            <li class="bg-black/20 p-3 rounded border border-white/5">
                                <strong class="text-white block mb-1">Soft Delete</strong>
                                Listas "Excluídas" pela noiva devem permanecer no banco com flag `is_visible=false` para auditoria de trocas.
                            </li>
                        </ul>
                    </section>

                </div>
            </div>

        </div>
    </main>

    <footer class="text-center p-6 text-live-subtle text-xs border-t border-white/10 mt-auto bg-live-bg/95">
        <p class="opacity-60">Gerado por AgeQuodAgis V3.3 | Live Consultoria</p>
        <p class="mt-1 opacity-40 font-mono">Build ID: GOIANITA_DEV_SPEC_2025</p>
    </footer>

    <!-- Lógica de Abas -->
    <script>
        function switchTab(tabId) {
            // Hide all
            document.querySelectorAll('.tab-content').forEach(el => {
                el.classList.add('hidden');
                el.classList.remove('block', 'fade-in');
            });
            
            // Deactivate buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected
            const target = document.getElementById(tabId);
            target.classList.remove('hidden');
            target.classList.add('block');
            
            // Trigger animation
            void target.offsetWidth; 
            target.classList.add('fade-in');

            // Activate button
            document.getElementById('btn-' + tabId).classList.add('active');
        }
    </script>
</body>
</html>
